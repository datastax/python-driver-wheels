name: Build wheels (Windows)

on: [workflow_dispatch]

jobs:
  build_wheels_win:
    name: Build wheels on windows-2022
    runs-on: windows-2022
    env:
      CIBW_BUILD: cp38-* cp39-* cp310-* cp311-* cp312-*
      CIBW_SKIP: "*musllinux*"
      CIBW_TEST_REQUIRES: pytest mock pure-sasl eventlet
      CIBW_TEST_COMMAND: echo "wheel is installed"
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true
      - uses: lukka/run-vcpkg@v11
        with:
          vcpkgGitCommitId: 9a6da16845eca8d6ed70be416c1acbd206894c7f
          runVcpkgInstall: true
      - uses: pypa/cibuildwheel@v2.19.2
        with:
          package-dir: ./python-driver
      - uses: actions/upload-artifact@v3
        with:
          path: python-driver/wheelhouse/*.whl
      - uses: actions/upload-artifact@v4
        with:
          name: cibw-wheels-win
          path: ./wheelhouse/*.whl
